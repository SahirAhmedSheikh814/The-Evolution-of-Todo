# Default values for todo-web-app
# This is a YAML-formatted file for local Minikube deployment

# Global settings
global:
  domain: todo.local

# Backend Configuration
backend:
  enabled: true
  replicaCount: 1

  image:
    repository: todo-backend
    pullPolicy: Never  # Use local images in Minikube
    tag: "latest"

  service:
    type: NodePort
    port: 8000
    targetPort: 8000
    nodePort: 30800  # Access via http://minikube-ip:30800

  env:
    - name: DATABASE_URL
      value: "postgresql+asyncpg://neondb_owner:npg_"
    - name: SECRET_KEY
      value: "Your-Secret-Key-Here"
    - name: ACCESS_TOKEN_EXPIRE_MINUTES
      value: "30"
    - name: ALGORITHM
      value: "HS256"
    - name: PROJECT_NAME
      value: "TodoApp"
    - name: OPENAI_API_KEY
      value: "Your-Open-AI-API-Key"
    - name: OPENAI_BASE_URL
      value: "https://api.openai.com/v1"

  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi

  livenessProbe:
    httpGet:
      path: /docs
      port: 8000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /docs
      port: 8000
    initialDelaySeconds: 20
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Frontend Configuration
frontend:
  enabled: true
  replicaCount: 1

  image:
    repository: todo-frontend
    pullPolicy: Never  # Use local images in Minikube
    tag: "latest"

  service:
    type: NodePort  # Use NodePort for Minikube access
    port: 3000
    targetPort: 3000
    nodePort: 30080  # Access via http://minikube-ip:30080

  env:
    - name: NEXT_PUBLIC_API_URL
      value: "http://192.168.49.2:30800"

  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi

  livenessProbe:
    httpGet:
      path: /
      port: 3000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /
      port: 3000
    initialDelaySeconds: 20
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Service Account
serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

# Pod settings
podAnnotations: {}
podLabels:
  app: todo-web-app

podSecurityContext:
  fsGroup: 1001

securityContext:
  runAsNonRoot: true
  runAsUser: 1001
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false

# Ingress configuration (optional for Minikube)
ingress:
  enabled: false
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
  hosts:
    - host: todo.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

# Autoscaling (disabled for local deployment)
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# Node selection
nodeSelector: {}

tolerations: []

affinity: {}

# Additional volumes
volumes: []
volumeMounts: []
